<!doctype html>
<html lang="en" ng-app="paperHive" ng-strict-di ng-csp>
  <head>
    <title>PaperHive Extension Popup</title>
    <meta charset="utf-8">
    <link href="popup.css" rel="stylesheet">
    <script src="popup.js"></script>
  </head>
  <body ng-controller="PopupCtrl">
    <header>
      <nav class="navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <a class="navbar-brand" target="_blank" ng-href="{{frontendUrl}}"
                                               title="PaperHive">
              <img
                class="ph-title-logo"
                src="images/logo-full.svg"
                >
            </a>
          </div>
        </div>
      </nav>
    </header>

    <main>
    <div ng-if="!document.revisions" class="well">
      This page is not yet available for discussion on PaperHive.
      Do you think it would be a worthwhile addition?
    </div>

    <div ng-if="document.revisions[document.indices.thisRevision]" class="panel panel-default">
      <div class="panel-body">
        <h4>
          <a ng-if="document.revisions[document.indices.thisRevision]"
             target="_blank"
             ng-href="{{frontendUrl}}/documents/{{document.revisions[document.indices.thisRevision].id}}?revision={{document.revisions[document.indices.thisRevision].revision}}">
            {{document.revisions[document.indices.thisRevision].title}}</a>
          <span ng-if="!document.revisions[document.indices.thisRevision]">
            {{document.revisions[document.indices.thisRevision].title}}
          </span>
        </h4>
        <div>
          <span ng-repeat="author in document.revisions[document.indices.thisRevision].authors">
            {{author.name}}{{$last ? '' : ', '}}
          </span>
        </div>
      </div>
    </div>

    <div ng-if="!document.revisions[document.indices.thisRevision].openAccess
         && document.indices.newestOa > 0"
      class="alert alert-warning"
      role="alert">
      There is an <strong>open-access</strong> version of this article
      available via
      {{document.revisions[document.indices.newestOa].remote.type}}
      <span ng-if="document.revisions[document.indices.newestOa].volume">
      , volume {{document.revisions[document.indices.newestOa].volume}}
      </span>
      <span ng-if="document.revisions[document.indices.newestOa].issue">
       , issue {{document.revisions[document.indices.newestOa].issue}}
      </span>
      <span ng-if="document.revisions[document.indices.newestOa].publishedAt">
       (published {{document.revisions[document.indices.newestOa].publishedAt | date}}).
      </span>
    </div>

    <div ng-if="document.indices.thisRevision < document.revisions.length - 1"
      class="alert alert-warning"
      role="alert">
      There is a more recent
      <strong ng-if="document.revisions[document.revisions.length - 1].openAccess">
        open-access
      </strong>
      version of this article in <strong>
      {{document.revisions[document.revisions.length - 1].journalName}}
      <span ng-if="document.revisions[document.revisions.length - 1].volume">
      , volume {{document.revisions[document.revisions.length - 1].volume}}
      </span>
      <span ng-if="document.revisions[document.revisions.length - 1].issue">
       , issue {{document.revisions[document.revisions.length - 1].issue}}
      </span>
      <span ng-if="document.revisions[document.revisions.length -
        1].publishedAt">
       (published {{document.revisions[document.revisions.length -
       1].publishedAt | date}}).
      </span>
      </strong>
    </div>

    <div ng-if="document.discussions && document.discussions.length > 0"
      class="panel panel-default"
      >
      <div class="panel-heading">
        <strong>
          <i class="fa fa-comment"></i> {{document.discussions.length}} open discussions
        </strong>
      </div>
      <ul class="list-group">
        <li class="list-group-item" ng-repeat="discussion in document.discussions">
          <a target="_blank"
             ng-href="{{frontendUrl}}/documents/{{document.meta._id}}/discussions/{{discussion.index}}">
             <span
             ng-if="discussion.replies.length > 0"
             class="pull-right ph-discussion-replies-counter"
             >
             <i class="fa fa-comments"></i> {{discussion.replies.length}}
             </span></a>
             <div>
               <a target="_blank"
                 ng-href="{{frontendUrl}}/documents/{{document.meta._id}}/discussions/{{discussion.index}}">
                 {{discussion.originalAnnotation.title}}</a>
             </div>
             <span class="ph-discussion-subtitle">
               #{{discussion.index}} opened
               <span am-time-ago="discussion.originalAnnotation.createdAt"></span>
               by
               <a target="_blank" ng-href="{{frontendUrl}}/users/{{discussion.originalAnnotation.author.username}}">
                 {{discussion.originalAnnotation.author.displayName}}
               </a>
             </span>
        </li>
      </ul>
    </div>
    </main>

    <footer class="ph-footer">
      <a ng-if="document.meta && document.meta._id"
         id="link" target="_blank" role="button" class="btn btn-primary"
         ng-href="{{frontendUrl}}/documents/{{document.meta._id}}"
         >
        Open in PaperHive
      </a>

      <button ng-if="document.revisions && !document.meta._id"
         type="submit"
         ng-click="submitApproved(tabUrl)"
         class="btn btn-primary"
         ng-disabled="submitting"
         >
         <i class="fa fa-fw fa-plus" ng-if="!submitting"></i>
         <i class="fa fa-fw fa-spinner fa-spin" ng-if="submitting"></i>
         Open in PaperHive
      </button>

      <a ng-if="!document.revisions"
         type="link"
         class="btn btn-primary"
         target="_blank"
         ng-href="
mailto:info@paperhive.org
?subject=Article suggestion
&body=Hi,%0D%0A%0D%0A
I found this document on%0D%0A
%0D%0A
  {{tabUrl}}%0D%0A
%0D%0A
and I think you should add it PaperHive.%0D%0A%0D%0A
Thanks!"
         >
         Yes!
      </a>

      <!--span ng-if="!document.meta && !isWhitelistedHost">
        PaperHive only deals with PDFs from whitelisted sources. If you like to
        have more sources included, give us some <a
            ng-href="{{frontendUrl}}/contact" target="_blank">feedback</a>!
      </span-->
      <a
        class="ph-feedback"
        target="_blank"
        ng-href="{{frontendUrl}}/contact"
        >
        Feedback</a>
    </footer>

  </body>
</html>
